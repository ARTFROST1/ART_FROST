---
/**
 * Header Component
 * Fixed header with glassmorphism background
 * Includes logo, navigation, theme toggle, and mobile menu button
 *
 * @example
 * <Header currentPath={Astro.url.pathname} />
 */

import { cn } from '@lib/utils';
import Navigation from './Navigation.astro';
import { ThemeToggle } from './ThemeToggle';
import Button from '@components/common/Button.astro';
import Icon from '@components/common/Icon.astro';

interface Props {
  /** Current page path for active state */
  currentPath: string;
  /** Additional CSS classes */
  class?: string;
}

const { currentPath, class: className } = Astro.props;

// Header styles
const headerStyles = cn(
  'fixed top-0 left-0 right-0 z-50',
  'bg-transparent',
  'transition-colors duration-300',
  className
);

// Container с фиксированной высотой для всех элементов
const containerStyles = cn(
  'max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8',
  'h-20', // Фиксированная высота контейнера
  'flex items-center justify-between', // Все элементы центрированы вертикально
  'relative' // Для абсолютного позиционирования навигации
);
---

<header class={headerStyles} role="banner">
  <div class={containerStyles}>
    <!-- Logo / Brand - всегда слева -->
    <a
      href="/"
      class={cn(
        'flex items-center gap-2 shrink-0',
        'text-[var(--color-text-heading)] font-display font-bold',
        'text-lg sm:text-xl', // Адаптивный размер текста
        'hover:text-[var(--color-primary)]',
        'transition-colors duration-200',
        'z-10'
      )}
      aria-label="Art Frost - Главная"
    >
      <span class="text-[var(--color-primary)]">&lt;</span>
      <span>Art Frost</span>
      <span class="text-[var(--color-primary)]">/&gt;</span>
    </a>

    <!-- Desktop Navigation - абсолютное центрирование -->
    <div class={cn(
      'absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2',
      'hidden lg:block' // Скрываем раньше на меньших экранах
    )}>
      <Navigation currentPath={currentPath} />
    </div>

    <!-- Right side: Theme Toggle + CTA Buttons + Mobile Menu -->
    <div class="flex items-center gap-2 sm:gap-3 z-10 shrink-0">
      <!-- Theme Toggle - всегда видна -->
      <ThemeToggle client:load />

      <!-- CTA Buttons - показываем только на больших экранах -->
      <div class="hidden lg:flex items-center gap-3">
        <Button href="/links" variant="ghost" size="md">Sign In</Button>
        <Button href="https://t.me/artfrost" external variant="primary" size="md">
          Get Started
        </Button>
      </div>

      <!-- Mobile Menu Button - видна только на малых экранах -->
      <button
        id="mobile-menu-button"
        type="button"
        class={cn(
          'lg:hidden', // Скрываем на больших экранах
          'relative inline-flex items-center justify-center',
          'h-11 w-11 rounded-xl',
          'border border-[var(--color-border-glass)]',
          'bg-[var(--color-bg-glass)] backdrop-blur-xl',
          'text-[var(--color-text-heading)]',
          'transition-all duration-300',
          'hover:bg-[var(--color-bg-glass-strong)]',
          'hover:border-[var(--color-primary)]/30',
          'hover:text-[var(--color-primary)]',
          'hover:shadow-[0_0_24px_-8px_var(--color-primary-glow)]',
          '[html[data-theme="light"]_&]:bg-black/5',
          '[html[data-theme="light"]_&]:hover:bg-black/10',
          'focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]/35'
        )}
        aria-expanded="false"
        aria-controls="mobile-menu"
        aria-label="Открыть меню"
      >
        <Icon name="menu" size="md" class="menu-icon transition-transform duration-200" />
        <Icon name="x" size="md" class="close-icon hidden transition-transform duration-200" />
      </button>
    </div>
  </div>
</header>

<!-- Spacer to prevent content from hiding under fixed header -->
<div class="h-16" aria-hidden="true"></div>

<script>
  // Simple mobile menu toggle without React
  // Full mobile menu is handled by MobileMenu.tsx component
  const button = document.getElementById('mobile-menu-button');
  const menuIcon = button?.querySelector('.menu-icon');
  const closeIcon = button?.querySelector('.close-icon');

  button?.addEventListener('click', () => {
    const isExpanded = button.getAttribute('aria-expanded') === 'true';
    button.setAttribute('aria-expanded', String(!isExpanded));

    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');

    // Dispatch custom event for MobileMenu React component
    window.dispatchEvent(
      new CustomEvent('toggle-mobile-menu', {
        detail: { isOpen: !isExpanded },
      })
    );
  });

  // Добавление фона при скролле для улучшения читаемости
  const header = document.querySelector('header[role="banner"]');
  
  const handleScroll = () => {
    if (!header) return;
    
    if (window.scrollY > 20) {
      header.classList.add('bg-[var(--color-bg-glass)]', 'backdrop-blur-xl', 'border-b', 'border-[var(--color-border-glass)]', 'shadow-lg');
    } else {
      header.classList.remove('bg-[var(--color-bg-glass)]', 'backdrop-blur-xl', 'border-b', 'border-[var(--color-border-glass)]', 'shadow-lg');
    }
  };

  // Initial check
  handleScroll();
  
  // Listen for scroll
  window.addEventListener('scroll', handleScroll, { passive: true });
</script>
