---
/**
 * FeaturedProjects Section Component
 * Displays featured projects from Content Collections
 *
 * @example
 * <FeaturedProjects />
 */

import { getCollection } from 'astro:content';
import { cn } from '@lib/utils';
import Section from '@components/common/Section.astro';
import Icon from '@components/common/Icon.astro';
import Button from '@components/common/Button.astro';
import { ProjectCard } from '@components/projects';

interface Props {
  /** Additional CSS classes */
  class?: string;
}

const { class: className } = Astro.props;

// Get featured projects from Content Collections
const allProjects = await getCollection('projects');
const featuredProjects = allProjects
  .filter(project => project.data.featured && !project.data.draft)
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999))
  .slice(0, 4); // Limit to 4 featured projects
---

<Section
  id="projects"
  spacing="xl"
  class={cn('relative overflow-hidden', className)}
>
  <!-- Background decoration: layered ambient glows -->
  <div class="absolute inset-0 pointer-events-none overflow-hidden" aria-hidden="true">
    <!-- Primary glow (top-right) -->
    <div
      class="absolute top-0 right-0 w-[600px] h-[600px] opacity-100"
      style="background: radial-gradient(circle at 70% 20%, rgba(16,185,129,0.15) 0%, transparent 60%);"
    />
    <!-- Secondary glow (bottom-left) -->
    <div
      class="absolute bottom-0 left-0 w-[500px] h-[500px] opacity-100"
      style="background: radial-gradient(circle at 20% 80%, rgba(16,185,129,0.10) 0%, transparent 65%);"
    />
    <!-- Subtle vignette -->
    <div
      class="absolute inset-0"
      style="background: radial-gradient(circle at 50% 50%, rgba(0,0,0,0) 30%, rgba(0,0,0,0.3) 100%);"
    />
  </div>

  <!-- Section Header -->
  <div class="relative z-10 text-center mb-12 md:mb-16 animate-on-scroll">
    <span class="inline-block text-[var(--color-primary)] text-sm font-medium uppercase tracking-widest mb-4">
      Портфолио
    </span>
    <h2 class="heading-section mb-4">
      Последние{' '}
      <span class="bg-gradient-to-r from-[var(--color-gradient-start)] to-[var(--color-gradient-end)] bg-clip-text text-transparent">
        проекты
      </span>
    </h2>
    <p class="body-large max-w-2xl mx-auto text-[var(--color-text-muted)]">
      Избранные работы, демонстрирующие мой подход к разработке и дизайну
    </p>
  </div>

  <!-- Projects Grid using ProjectCard -->
  <div class="relative z-10 grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
    {featuredProjects.map((project, index) => (
      <div class={cn(index === 0 && 'md:col-span-2')}>
        <ProjectCard
          project={project}
          size={index === 0 ? 'large' : 'default'}
          showFeatured={true}
          animationDelay={index * 100}
        />
      </div>
    ))}
  </div>

  <!-- View All Button -->
  <div class="relative z-10 flex justify-center mt-12 animate-on-scroll" style="animation-delay: 400ms;">
    <Button href="/projects" variant="secondary" size="lg">
      <span class="flex items-center gap-2">
        <span>Все проекты</span>
        <Icon name="arrow-right" size="sm" />
      </span>
    </Button>
  </div>
</Section>
